{% extends 'pm/home.html' %}

{% block title %}Manage Properties{% endblock %}

{% block content %}
  <h2>My Properties</h2>

  {% if properties or complexes %}
    {% if complexes %}
      <h3>Property Complexes</h3>
      <div class="property-grid">
        {% for complex in complexes %}
          <div class="property-card">
            <div class="property-header">
              <h3>{{ complex.address }}</h3>
              <span class="status complex">{{ complex.units.count }} UNITS</span>
            </div>
            {% for unit in units %}
              {% if unit.complex == complex %}
                <strong>{{unit.nickname}}</strong> - Floor:{{unit.floor}} Number:{{unit.number}} - {{unit.get_property_type_display}} - <button class="btn btn-outline">Manage Unit</button><br>
              {% endif %}
            {% endfor %}
            {% if not units %}
              <p style="text-align: center;">No units added</p>
            {% endif %}
            <div class="property-details">
              <div style="text-align: center; margin-top: 10px;">
                <a href="{% url "add_property_to_complex" complex.address %}" class="btn btn-primary">Add Unit</a>
                <a href="{% url "delete_complex" complex.id %}" class="btn btn-outline">Delete Complex</a>
              </div>
            </div>
          </div>
        {% endfor %}
      </div>
      <hr style="margin: 40px 0;">
    {% endif %}
    <h3>Individual Properties</h3>
    <div class="property-grid">
      {% for property in properties %}
        <div class="property-card">
          <div class="property-header">
            <h3>{{ property.address }}</h3>
            {% if property.status == 'available' %}
            <span class="status {{ property.status|lower }}"><h2 style="color:#97f75c">{{ property.status.upper }}</h2></span>
            {% else %}
            <span class="status {{ property.status|lower }}"><h2 style="color:#f73434">{{ property.status.upper }}</h2></span>
            {% endif %}
          </div>
          <div class="property-details">
            <p><strong>Type:</strong> {{ property.get_property_type_display }}</p>
            <p><strong>Size:</strong> {{ property.property_size }}</p>
            <p><strong>Bedrooms:</strong> {{ property.bedrooms }} | <strong>Bathrooms:</strong> {{ property.bathrooms }}</p>
            <p><strong>Parking:</strong> {{ property.parking_spaces }}</p>
            <p><strong>Amenities:</strong> {{ property.amenities }}</p>
            <p><strong>Description:</strong> {{ property.description }}</p>
            <div style="text-align: center; margin-top: 10px;">
              {% if property.id in leased_properties %}
                  <a href="{% url "edit_lease" property.id %}" class="btn btn-outline">View Lease</a>
              {% else %}
                <a href="{% url "create_lease" property.id %}" class="btn btn-primary">Create Lease</a>
              {% endif %}
            </div>
          </div>
          <div style="text-align: center; margin-top: 10px;">
            <a href="{% url "edit_property" property.id %}" class="btn btn-primary">Edit Property</a>
            <a href="{% url "delete_property" property.id %}" class="btn btn-outline">Delete Property</a>
          </div>
        </div>
      {% endfor %}
    </div>

  {% else %}
    <p>You haven't added any properties yet.</p>
  {% endif %}
  <div style="text-align: center; margin-top: 20px;">
    <a href="{% url "new_property_page" %}" class="btn btn-primary">Add Property</a>
  </div>
{% endblock %}